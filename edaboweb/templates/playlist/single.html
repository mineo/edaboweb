{% extends "base.html" %}
{% set active_page = 'playlists' %}
{% block scripts %}

{{ super() }}
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script type="text/javascript">
 function fixImage(event) {
     $(event.target).attr("src", "{{ url_for('static', filename='disc.svg')}}");
 }

 function fallbackImages() {
     $(".cover").on("error", fixImage);
 }

 fallbackImages();


 function changeCoverSize(howMuch) {
     change = function () {
         $(".cover").width(
             function(idx, oldWidth){
                 $(this).width(oldWidth + howMuch);
             });
     }
     return change;
 }

 $("#inc-covers").click(changeCoverSize(50));
 $("#dec-covers").click(changeCoverSize(-50));
</script>
{% endblock %}

{% block innercontent %}
<h1 class="page-header">
    <div class="row">
        <div class="col-md-10">
            {{ playlist.data["name"] }}
            <small>
                {% if playlist.data["description"] %}
                {{ playlist.data["description"] }}
                {% else %}
                This playlist has no description.
                {% endif %}
            </small>
        </div>
        <div class="col-md-2">
            <a href="#" id="inc-covers" class="glyphicon glyphicon-plus-sign">
            </a>
            <a href="#" id="dec-covers" class="glyphicon glyphicon-minus-sign">
            </a>
        </div>
    </div>
</h1>
{% for release, tracks in releases.iteritems() %}
<div class="panel panel-default"">
    <div class="panel-heading">
        {{ release }}
    </div>
    <div class="media panel-body">
        <div class="media-left">
            <img class="cover"
                 {% if release is none %}
                 src="{{ url_for('static', filename='disc.svg') }}" />
            {% else %}
            src="//coverartarchive.org/release/{{ release }}/front-250"/>
            {% endif %}
        </div>
        <div class="media-body">
            <div class="list-group">
                {% for track in tracks %}
                <div class="list-group-item">
                    {% set data = recordings[track.recordingid] %}
                    {% if data is defined %}
                    <a href="https://musicbrainz.org/
                             {%- if data[2] is none -%}
                             recording/{{ track.recordingid }} "
                       {%- else -%}
                       track/{{ data[2] }}"
                       {% endif %}>
                        {{ data[0] }}
                    </a>
                    by {{ data[1] }}
                    {% else %}
                    Sorry
                    we don't have data for {{ track.recordingid }} yet.
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}
