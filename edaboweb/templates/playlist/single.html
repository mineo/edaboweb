{% extends "base.html" %}
{% set active_page = 'playlists' %}
{% block scripts %}

{{ super() }}
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script type="text/javascript">
 function fixImage(event) {
     $(event.target).attr("src", "{{ url_for('static', filename='disc.svg')}}");
 }

 function fallbackImages() {
     $(".cover").on("error", fixImage);
 }
 fallbackImages();
</script>
{% endblock %}

{% block innercontent %}
<h1 class="page-header">
  {{ playlist.data["name"] }}
  <small>
  {% if playlist.data["description"] %}
  {{ playlist.data["description"] }}
  {% else %}
  This playlist has no description.
  {% endif %}
  </small>
</h1>
    </div>
  </li>
  {% endfor %}
</ul>
{% for release, tracks in releases.iteritems() %}
<div class="panel panel-default"">
    <div class="panel-heading">
        {{ release }}
    </div>
    <div class="media panel-body">
        <div class="media-left">
            <img class="cover"
                 {% if release is none %}
                 src="{{ url_for('static', filename='disc.svg') }}" />
            {% else %}
            src="//coverartarchive.org/release/{{ release }}/front-250"/>
            {% endif %}
        </div>
        <div class="media-body">
            <div class="list-group">
                {% for track in tracks %}
                <div class="list-group-item">
                    {% set data = recordings[track.recordingid] %}
                    {% if data is defined %}
                    <a href="https://musicbrainz.org/
                             {%- if data[2] is none -%}
                             recording/{{ track.recordingid }} "
                       {%- else -%}
                       track/{{ data[2] }}"
                       {% endif %}>
                        {{ data[0] }}
                    </a>
                    by {{ data[1] }}
                    {% else %}
                    Sorry
                    we don't have data for {{ track.recordingid }} yet.
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endfor %}
{% endblock %}
