{% extends "base.html" %}
{% set active_page = 'playlists' %}
{% block scripts %}

{{ super() }}
<script src="//code.jquery.com/jquery-1.11.2.min.js"></script>
<script type="text/javascript">
  function fixImage(event) {
      $(event.target).attr("src", "{{ url_for('static', filename='disc.svg')}}");
  }

  function fallbackImages() {
      $(".cover").on("error", fixImage);
  }
  fallbackImages();
</script>
{% endblock %}

{% block innercontent %}
<h1 class="page-header">
  {{ playlist.data["name"] }}
  <small>
  {% if playlist.data["description"] %}
  {{ playlist.data["description"] }}
  {% else %}
  This playlist has no description.
  {% endif %}
  </small>
</h1>
<ul class="list-group">
  {% for track in playlist.data["tracklist"] %}
  <li class="list-group-item">
    <div class="media">
    {% set data = recordings[track.recordingid] %}
    {% if data is defined %}
      {% if release_ids[track.recordingid] is none %}
        <div class="media-left media-middle glyphicon glyphicon-music">
        </div>
      {% else %}
        <div class="media-left">
          <img
             class="cover"
             src="//coverartarchive.org/release/{{ release_ids[track.recordingid] }}/front-250"/>
        </div>
      {% endif %}
      <div class="media-body">
        <a href="https://musicbrainz.org/
                 {%- if data[2] is none -%}
                 recording/{{ track.recordingid }} "
                 {%- else -%}
                 track/{{ data[2] }}"
                 {% endif %}>
                 <h4 class="media-heading">
                   {{ data[0] }}
                 </h4>
        </a>
        <p>
          by {{ data[1] }}
        </p>
      </div>
      {% endif %}
    </div>
  </li>
  {% endfor %}
</ul>
{% endblock %}
